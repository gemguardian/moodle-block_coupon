{"version":3,"file":"preview.min.js","sources":["../src/preview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Preview modal implementation.\n *\n * @copyright  2019 R.J. van Dongen <rogier@sebsoft.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n\n    /**\n     * Encode uri parameters.\n     *\n     * @param {Object} data\n     * @return {String}\n     */\n    var encodeQueryParams = function (data) {\n        const ret = [];\n        for (let d in data) {\n            ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));\n        }\n        return ret.join('&');\n    };\n\n    /**\n     * Constructor\n     * @param {string} clickselector\n     * @param {string} url\n     */\n    var CouponPreview = function(clickselector, url) {\n        this.selector = clickselector;\n        this.url = url;\n        Str.get_string('preview-pdf', 'block_coupon').then(function(title) {\n            this.title = title;\n            this.setupHandlers();\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * @var {string} modal title\n     */\n    CouponPreview.prototype.title = null;\n\n    /**\n     * @var {string} preview loader url\n     */\n    CouponPreview.prototype.url = null;\n\n    /**\n     * @var {Object} modal\n     */\n    CouponPreview.prototype.modal = null;\n\n    /**\n     * @var {string} click selector opening the modal\n     */\n    CouponPreview.prototype.selector = null;\n\n    /**\n     * Close handler\n     */\n    CouponPreview.prototype.closeHandler = function() {\n        this.destroy();\n    };\n\n    /**\n     * Out of bounds click handler handler\n     * @param {Event} e\n     */\n    CouponPreview.prototype.clickOutHandler = function(e) {\n        if ($(e.target) == this.modal) {\n            this.destroy();\n        }\n    };\n\n    /**\n     * Handler to setup the modal\n     */\n    CouponPreview.prototype.setupHandler = function() {\n        var url = this.url, extraparams = {}, el = null;\n        el = document.getElementById('id_font');\n        if (el !== undefined) {\n            extraparams.font = el.options[el.options.selectedIndex].text;\n        }\n        el = document.getElementById('id_renderqrcode');\n        if (el !== undefined && el.checked) {\n            extraparams.qr = 1;\n        }\n        if (Object.keys(extraparams).length) {\n            if (url.indexOf('?') >= 0) {\n                url += '&' + encodeQueryParams(extraparams);\n            } else {\n                url += '?' + encodeQueryParams(extraparams);\n            }\n        }\n        // Create container.\n        var html = '<div id=\"block-coupon-modal\"><div class=\"block-coupon-modal-content\">';\n        html += '<div class=\"block-coupon-modal-header\">';\n        html += '<span id=\"block-modal-close\" class=\"close\">&times;</span>';\n        html += '<h2>' + this.title + '</h2>';\n        html += '</div>';\n        html += '<div class=\"block-coupon-modal-body\">';\n        html += '<iframe src=\"' + url + '\"></iframe>';\n        html += '</div>';\n        html += '</div></div>';\n        this.modal = $(html);\n        $('body').append(this.modal);\n        this.modal.hide();\n        $('#block-modal-close').on('click', this.destroy.bind(this));\n        $('body').on('click', this.clickOutHandler.bind(this));\n        this.modal.show();\n    };\n\n    /**\n     * Setup external handlers\n     */\n    CouponPreview.prototype.setupHandlers = function() {\n        $(this.selector).on('click', this.setupHandler.bind(this));\n    };\n\n    /**\n     * Destroy the modal\n     */\n    CouponPreview.prototype.destroy = function() {\n        // Destroy some handlers.\n        $('#block-modal-close').off('click');\n        $('body').off('click');\n        // Destroy modal container.\n        this.modal.hide();\n        this.modal.remove();\n    };\n\n    return /** @alias module:block_coupon/preview */ {\n        init: function(clickselector, url) {\n            new CouponPreview(clickselector, url);\n        }\n    };\n\n});\n"],"names":["define","$","Str","Notification","encodeQueryParams","data","ret","d","push","encodeURIComponent","join","CouponPreview","clickselector","url","selector","get_string","then","title","setupHandlers","bind","this","fail","exception","prototype","modal","closeHandler","destroy","clickOutHandler","e","target","setupHandler","extraparams","el","undefined","document","getElementById","font","options","selectedIndex","text","checked","qr","Object","keys","length","indexOf","html","append","hide","on","show","off","remove","init"],"mappings":";;;;;;AAsBAA,8BAAO,CAAC,SAAU,WAAY,sBAAsB,SAASC,EAAGC,IAAKC,kBAQ7DC,kBAAoB,SAAUC,UACxBC,IAAM,OACP,IAAIC,KAAKF,KACVC,IAAIE,KAAKC,mBAAmBF,GAAK,IAAME,mBAAmBJ,KAAKE,YAE5DD,IAAII,KAAK,MAQhBC,cAAgB,SAASC,cAAeC,UACnCC,SAAWF,mBACXC,IAAMA,IACXX,IAAIa,WAAW,cAAe,gBAAgBC,KAAK,SAASC,YACnDA,MAAQA,WACRC,iBACPC,KAAKC,OAAOC,KAAKlB,aAAamB,mBAMpCX,cAAcY,UAAUN,MAAQ,KAKhCN,cAAcY,UAAUV,IAAM,KAK9BF,cAAcY,UAAUC,MAAQ,KAKhCb,cAAcY,UAAUT,SAAW,KAKnCH,cAAcY,UAAUE,aAAe,gBAC9BC,WAOTf,cAAcY,UAAUI,gBAAkB,SAASC,GAC3C3B,EAAE2B,EAAEC,SAAWT,KAAKI,YACfE,WAObf,cAAcY,UAAUO,aAAe,eAC/BjB,IAAMO,KAAKP,IAAKkB,YAAc,GAAIC,GAAK,UAEhCC,KADXD,GAAKE,SAASC,eAAe,cAEzBJ,YAAYK,KAAOJ,GAAGK,QAAQL,GAAGK,QAAQC,eAAeC,WAGjDN,KADXD,GAAKE,SAASC,eAAe,qBACLH,GAAGQ,UACvBT,YAAYU,GAAK,GAEjBC,OAAOC,KAAKZ,aAAaa,SACrB/B,IAAIgC,QAAQ,MAAQ,EACpBhC,KAAO,IAAMT,kBAAkB2B,aAE/BlB,KAAO,IAAMT,kBAAkB2B,kBAInCe,KAAO,wEACXA,MAAQ,0CACRA,MAAQ,4DACRA,MAAQ,OAAS1B,KAAKH,MAAQ,QAC9B6B,MAAQ,SACRA,MAAQ,wCACRA,MAAQ,gBAAkBjC,IAAM,cAChCiC,MAAQ,SACRA,MAAQ,oBACHtB,MAAQvB,EAAE6C,MACf7C,EAAE,QAAQ8C,OAAO3B,KAAKI,YACjBA,MAAMwB,OACX/C,EAAE,sBAAsBgD,GAAG,QAAS7B,KAAKM,QAAQP,KAAKC,OACtDnB,EAAE,QAAQgD,GAAG,QAAS7B,KAAKO,gBAAgBR,KAAKC,YAC3CI,MAAM0B,QAMfvC,cAAcY,UAAUL,cAAgB,WACpCjB,EAAEmB,KAAKN,UAAUmC,GAAG,QAAS7B,KAAKU,aAAaX,KAAKC,QAMxDT,cAAcY,UAAUG,QAAU,WAE9BzB,EAAE,sBAAsBkD,IAAI,SAC5BlD,EAAE,QAAQkD,IAAI,cAET3B,MAAMwB,YACNxB,MAAM4B,UAGkC,CAC7CC,KAAM,SAASzC,cAAeC,SACtBF,cAAcC,cAAeC"}